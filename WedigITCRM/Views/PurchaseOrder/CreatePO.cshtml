
@model PurchaseOrderViewModel

<div class="formcontainer">
    <div class="tableheadline">
        Indkøbsordre
    </div>
    <form method="post">
        <div class="row">
            <div class="col-2">
                <div class="row">
                    <div class="col-12">
                        <label for="selectvendor">Leverandør</label>
                        <select id="selectvendor" name="selectvendor" class="custom-select PurchaseOrderInput">
                        </select>
                        <input asp-for="@Model.VendorId" id="vendorid" type="hidden"/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="vendorname">Navn</label>
                        <input asp-for="@Model.VendorName" id="vendorname" class="PurchaseOrderInput"/>
                        <span asp-validation-for="@Model.VendorName" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="vendorstreet">Adresse</label>
                        <input asp-for="@Model.VendorStreet" id="vendorstreet" class="PurchaseOrderInput" />
                        <span asp-validation-for="@Model.VendorStreet" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="vendorzip">Postnummer</label>
                        <input asp-for="@Model.VendorZip" id="vendorzip" class="PurchaseOrderInput" />
                        <span asp-validation-for="@Model.VendorZip" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="vendorcity">By</label>
                        <input asp-for="@Model.VendorCity" id="vendorcity" class="PurchaseOrderInput"/>
                        <span asp-validation-for="@Model.VendorCity" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="vendorcountrycode">Landekode</label>
                        <input asp-for="@Model.VendorCountryCode" id="vendorcountrycode" class="PurchaseOrderInput"/>
                        <span asp-validation-for="@Model.VendorCountryCode" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="vendorphonenumber">Telefon</label>
                        <input asp-for="@Model.VendorPhoneNumber" id="vendorphonenumber" class="PurchaseOrderInput"/>
                        <span asp-validation-for="@Model.VendorPhoneNumber" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="class">Email</label>
                        <input asp-for="@Model.VendorEmail" id="vendoremail" class="PurchaseOrderInput"/>
                        <span asp-validation-for="@Model.VendorEmail" class="text-danger"></span>
                    </div>
                </div>

              

            </div>
            <div class="col-2">
                <div class="row">
                    <div class="col-12">
                        <label for="selectcurrency">Valuta</label>
                        <select id="selectcurrency" name="selectcurrency" class="custom-select PurchaseOrderInput">
                        </select>
                        <input asp-for="@Model.VendorCurrencyCode" id="vendorcurrencycode" class="PurchaseOrderInput" type="hidden" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <label for="selectpaymentcondition">Betalingsbetingelser</label>
                        <select id="selectpaymentcondition" name="selectpaymentcondition" class="custom-select PurchaseOrderInput">
                        </select>
                        <input asp-for="@Model.VendorPaymentConditionId" id="vendorpaymentconditionid" type="hidden" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="selectdeliverycondition">Leveringsbetingelser</label>
                        <select id="selectdeliverycondition" name="selectdeliverycondition" class="custom-select PurchaseOrderInput">
                        </select>
                        <input asp-for="@Model.VendorDeliveryConditionId" id="vendordeliveryconditionid" type="hidden" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="vendorreference"> Leverandørs ref.</label>
                        <input asp-for="@Model.VendorReference" id="vendorreference" class="PurchaseOrderInput" />
                        <span asp-validation-for="@Model.VendorReference" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="vendorreference">Vores ref.</label>
                        <input asp-for="@Model.OurReference" id="vendorreference" class="PurchaseOrderInput" />
                        <span asp-validation-for="@Model.OurReference" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label for="wanteddeliverydatepicker">Ønsket leveringsdato</label>
                        <input asp-for="@Model.OurWantedDeliveryDate" id="wanteddeliverydatepicker" class="PurchaseOrderInput" />
                        <span asp-validation-for="@Model.OurWantedDeliveryDate" class="text-danger"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <label for="ourorderingdatepicker">Bestillingsdato</label>
                        <input asp-for="@Model.OurOrderingDate" id="ourorderingdatepicker" class="PurchaseOrderInput" />
                        <span asp-validation-for="@Model.OurOrderingDate" class="text-danger"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <label>Notat til leverandør</label>
                        @Html.TextArea("Note", null, new { @class = "PurchaseOrderTextarea" })
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                            <button type="submit" class="btn btn-yahoo btn-sm">Gem</button>
                    </div>
                </div>
            </div>

            <div class="col-6">
                <!-- Trigger the modal with a button -->
                <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Tilføj ordrelinje</button>

                <!-- Modal -->
                <div class="modal fade" id="myModal" role="dialog">
                    <div class="modal-dialog modal-lg">

                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Ordrelinje</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-2">
                                        <label for="itemNameSuggest">Vare</label>
                                        <input name="itemNameSuggest" id="itemNameSuggest" class="PurchaseOrderInput" />
                                        <input name="stockitemid" id="stockitemid" class="PurchaseOrderInput" type="hidden" />
                                        <input id="ouritemname" class="PurchaseOrderInput" type="hidden" />
                                    </div>
                                    <div class="col-2">
                                        <label for="ouritemnumber">Varenummer</label>
                                        <input id="ouritemnumber" class="PurchaseOrderInput" />
                                    </div>
                                    <div class="col-2">
                                        <label for="quantitytoorder">Antal</label>
                                        <input id="quantitytoorder" class="PurchaseOrderInput" />
                                    </div>
                                    <div class="col-2">
                                        <label for="ouritemunit">Enheder</label>
                                        <input id="ouritemunit" class="PurchaseOrderInput" />
                                    </div>
                                    <div class="col-2">
                                        <label for="ourlocation">Lokation</label>
                                        <input id="ourlocation" class="PurchaseOrderInput" />
                                    </div>
                                    <div class="col-2">
                                        <label for="oursalesprice">Enhedspris</label>
                                        <input id="oursalesprice" class="PurchaseOrderInput" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-2">
                                        <label for="vendoritemnumber">Leverandørens varenummer</label>
                                        <input id="vendoritemnumber" class="PurchaseOrderInput" />
                                    </div>
                                    <div class="col-2">
                                        <label for="vendoritemname">Leverandørens varenummer</label>
                                        <input id="vendoritemname" class="PurchaseOrderInput" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-2">
                                        <button type="button" id="saveorderline" class="btn btn-default">Gem</button>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Luk</button>
                                </div>
                            </div>

                    </div>
                </div>
            </div>

        </div>
</form>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {

            getCurrencies();
            getAllVendors();
            getPaymentConditions();
            getDeliveryConditions();


            $('#selectvendor').bind('change', function () {
                var vendorId = $(this).val();
                $('#vendorid').val(vendorId);
                getVendorById(vendorId);
            });


            $('#selectcurrency').bind('change', function () {
                var currencyCode = $(this).val();
                $('#vendorcurrencycode').val(currencyCode);
            });

            $('#selectpaymentcondition').bind('change', function () {
                var vendorPaymentConditionId = $(this).val();
                $('#vendorpaymentconditionid').val(vendorPaymentConditionId);
            });

            $('#selectdeliverycondition').bind('change', function () {
                var vendorDeliveryConditionId = $(this).val();
                $('#vendordeliveryconditionid').val(vendorDeliveryConditionId);
            });

            $('#saveorderline').bind('click', function () {
                $.ajax({
                    type: "POST",
                    url: "/purchaseorder/saveOrderLine",
                    data: {
                        id: $('#stockitemid').val(),
                        ourItemNumber: $('#itemnumber').val(),
                        ourItemName: $('#ouritemname').val(),
                        ourSalesPrice: $('#oursalesprice').val(),
                        ourItemUnit: $('#ouritemunit').val(),
                        ourLocation: $('#ourlocation').val(),
                        vendorItemNumber: $('#vendoritemnumber').val(),
                        vendorItemName: $('#vendoritemname').val(),
                        quantityToOrder: $('#quantitytoorder').val()                       
                    },
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                     
                    },

                    error: function (request, status, error) {
                        var jsonErrorObj = request.responseJSON
                        var errorText = jsonErrorObj.Detail;
                        var errorTitle = jsonErrorObj.Title;
                        var errorInstance = jsonErrorObj.Instance;
                        location.href = "/home/ShowErrorForJSON?errorinstance=" + errorInstance;
                    }
                });
            });
            

            $("#ourorderingdatepicker").datetimepicker({
                timepicker: false,
                datepicker: true,
                hours12: false,
                format: 'd-m-Y'
            });


            $("#wanteddeliverydatepicker").datetimepicker({
                timepicker: false,
                datepicker: true,
                hours12: false,
                format: 'd-m-Y'
            });

            $("#itemNameSuggest").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '/stockitem/searchstockItemByNameAndVendor',
                        data: { term: request.term, vendorId: $('#vendorid').val() },
                        success: function (data) {
                            response(data);
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            var jsonErrorObj = jqXHR.responseJSON
                            var errorText = jsonErrorObj.Detail;
                            var errorTitle = jsonErrorObj.Title;
                            var errorInstance = jsonErrorObj.Instance;
                            location.href = "/home/ShowErrorForJSON?errorinstance=" + errorInstance;
                        },
                        dataType: 'json'
                    });
                },
                select: function (event, ui) {
                    $("#stockitemid").val(ui.item.stockItemId);
                    $("#itemNameSuggest").val(ui.item.label);
                    $("#ouritemname").val(ui.item.label);

                    var stockItemId = $("#stockitemid").val();
                    getStockItemById(stockItemId)
                },
                minLength: 1
            });
        });


        function getStockItemById(stockItemId) {
            $.ajax({
                type: "POST",
                url: "/purchaseorder/getStockItemById",
                data: 'id=' + stockItemId,
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $('#oursalesprice').val(result.ourSalesPrice);
                    $('#ouritemunit').val(result.ourItemUnit);
                    $('#ourlocation').val(result.ourLocation);
                    $('#ouritemnumber').val(result.ourItemNumber);                   
                    $('#quantitytoorder').val("1,00");

                    $('#vendoritemnumber').val(result.vendorItemNumber); 
                    $('#vendoritemname').val(result.vendorItemName); 
                    

                },

                error: function (request, status, error) {
                    var jsonErrorObj = request.responseJSON
                    var errorText = jsonErrorObj.Detail;
                    var errorTitle = jsonErrorObj.Title;
                    var errorInstance = jsonErrorObj.Instance;
                    location.href = "/home/ShowErrorForJSON?errorinstance=" + errorInstance;
                }
            });
        }

        function getVendorById(vendorId) {
            $.ajax({
                type: "POST",
                url: "/purchaseorder/getVendorById",
                data: 'id=' + vendorId,
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $('#vendorname').val(result.vendorName);
                    $('#vendorstreet').val(result.street);
                    $('#vendorzip').val(result.zip);
                    $('#vendorcity').val(result.city);
                    $('#vendorcountrycode').val(result.countryCode);
                    $('#vendorphonenumber').val(result.phoneNumber);
                    $('#vendoremail').val(result.vendorEmail);
                    $('#vendorcurrencycode').val(result.currencyCode);
                    $('#selectcurrency').val(result.currencyCode);

                    $('#selectpaymentcondition').val(result.vendorPaymentConditionsId);
                    $('#selectdeliverycondition').val(result.vendorDeliveryConditionsId);                  

                    $('#vendordeliveryconditionid').val(result.vendorDeliveryConditionsId);
                    $('#vendorpaymentconditionid').val(result.vendorPaymentConditionsId);                    
                },

                error: function (request, status, error) {
                    var jsonErrorObj = request.responseJSON
                    var errorText = jsonErrorObj.Detail;
                    var errorTitle = jsonErrorObj.Title;
                    var errorInstance = jsonErrorObj.Instance;
                    location.href = "/home/ShowErrorForJSON?errorinstance=" + errorInstance;
                }
            });
        }

        function getAllVendors() {
            $.ajax({
                type: "POST",
                url: "/purchaseorder/getAllVendors",
                data: 'id=' + "All",
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                dataType: "json",
                success: function (result) {

                    $('#selectvendor').html("");

                    $("<option/>", {
                        value: "0",
                        text: "<Vælg leverandør>"

                    }).appendTo("#selectvendor");

                    $.each(result, function (i, data) {
                        $("<option/>", {
                            value: data.id,
                            text: data.vendorName

                        }).appendTo("#selectvendor");
                    });

                    $('#selectvendor').val("0");
                },

                error: function (request, status, error) {
                    var jsonErrorObj = request.responseJSON
                    var errorText = jsonErrorObj.Detail;
                    var errorTitle = jsonErrorObj.Title;
                    var errorInstance = jsonErrorObj.Instance;
                    location.href = "/home/ShowErrorForJSON?errorinstance=" + errorInstance;
                }
            });

        }

        function getCurrencies() {
            $.ajax({
                type: "GET",
                url: "/purchaseorder/getCurrencies",
                dataType: "json",
                success: function (result) {

                    $('#selectcurrency').html("");

                    $("<option/>", {
                        value: "0",
                        text: "<Vælg valuta>"

                    }).appendTo("#selectcurrency");

                    $.each(result, function (i, data) {
                        $("<option/>", {
                            value: data.id,
                            text: data.id + "-" + data.description

                        }).appendTo("#selectcurrency");
                    });

                    $('#selectcurrency').val("0");
                },

                error: function (request, status, error) {
                    var jsonErrorObj = request.responseJSON
                    var errorText = jsonErrorObj.Detail;
                    var errorTitle = jsonErrorObj.Title;
                    var errorInstance = jsonErrorObj.Instance;
                    location.href = "/home/ShowErrorForJSON?errorinstance=" + errorInstance;
                }
            });

        }


        function getPaymentConditions() {
            $.ajax({
                type: "GET",
                url: "/vendor/getPaymentConditions",
                dataType: "json",
                success: function (result) {

                    $('#selectpaymentcondition').html("");

                    $("<option/>", {
                        value: "0",
                        text: "<Vælg betalingsbetingelse>"

                    }).appendTo("#selectpaymentcondition");

                    $.each(result, function (i, data) {
                        $("<option/>", {
                            value: data.value,
                            text: data.label
                        }).appendTo("#selectpaymentcondition");
                    });

                    $('#selectpaymentcondition').val("0");
                },

                error: function (request, status, error) {
                    var jsonErrorObj = request.responseJSON
                    var errorText = jsonErrorObj.Detail;
                    var errorTitle = jsonErrorObj.Title;
                    var errorInstance = jsonErrorObj.Instance;
                    location.href = "/home/ShowErrorForJSON?errorinstance=" + errorInstance;
                }
            });

        }

        function getDeliveryConditions() {
            $.ajax({
                type: "GET",
                url: "/vendor/getDeliveryConditions",
                dataType: "json",
                success: function (result) {

                    $('#selectdeliverycondition').html("");

                    $("<option/>", {
                        value: "0",
                        text: "<Vælg leveringsbetingelse>"

                    }).appendTo("#selectdeliverycondition");

                    $.each(result, function (i, data) {
                        $("<option/>", {
                            value: data.value,
                            text: data.label
                        }).appendTo("#selectdeliverycondition");
                    });

                    $('#selectdeliverycondition').val("0");
                },

                error: function (request, status, error) {
                    var jsonErrorObj = request.responseJSON
                    var errorText = jsonErrorObj.Detail;
                    var errorTitle = jsonErrorObj.Title;
                    var errorInstance = jsonErrorObj.Instance;
                    location.href = "/home/ShowErrorForJSON?errorinstance=" + errorInstance;
                }
            });

        }



    </script>
}